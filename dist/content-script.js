var n={SCROLL_TYPE:"glide",SPEED:100,DISTANCE:300,DELAY:2,SPACE_ENABLED:!1,DISABLED_SITES:["www.youtube.com","www.twitch.tv"]};class o{constructor(s){this.parent=s,this.rafId=null,this.yPos=window.scrollY}start(){if(!this.parent.enabled)return;this.stop();let s=performance.now();this.yPos=window.scrollY;const i=r=>{if(!this.parent.enabled)return;const l=(r-s)/1e3;s=r,this.yPos+=this.parent.speed*l,window.scrollTo(0,this.yPos),this.rafId=requestAnimationFrame(i)};this.rafId=requestAnimationFrame(i)}stop(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}get running(){return!!this.rafId}}class c{constructor(s){this.parent=s,this.intervalId=null}start(){!this.parent.enabled||!this.parent.delay||(this.stop(),this.intervalId=setInterval(()=>{this.parent.enabled&&window.scrollBy({top:this.parent.distance,behavior:"smooth"})},this.parent.delay*1e3))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}get running(){return!!this.intervalId}}class p{constructor(){this.scrollType=null,this.speed=0,this.distance=0,this.delay=0,this.spaceEnabled=!1,this.enabled=!0,this.glide=new o(this),this.step=new c(this)}get currentScroller(){return this.scrollType==="glide"?this.glide:this.step}start(){this.enabled&&(this.stop(),this.currentScroller.start())}stop(){this.glide.stop(),this.step.stop()}toggle(){this.running?this.stop():this.start()}setSettings(s={}){const i=this.running;"scrollType"in s&&s.scrollType!==this.scrollType&&(this.stop(),this.scrollType=s.scrollType),Object.assign(this,s),i&&this.start()}setEnabled(s){this.enabled=s,s||this.stop()}get running(){return this.currentScroller.running}}const t=new p;(async function(){const{scrollType:s=n.SCROLL_TYPE,speed:i=n.SPEED,distance:r=n.DISTANCE,delay:l=n.DELAY,spaceEnabled:a=n.SPACE_ENABLED,disabledSites:d=n.DISABLED_SITES}=await browser.storage.local.get(["scrollType","speed","distance","delay","spaceEnabled","disabledSites"]);t.setSettings({scrollType:s,speed:i,distance:r,delay:l,spaceEnabled:a}),t.setEnabled(!d.includes(location.hostname))})();browser.runtime.onMessage.addListener((e,s,i)=>{if(e.command==="start"&&t.start(),e.command==="stop"&&t.stop(),e.command==="status")return i({running:t.running}),!0});browser.storage.onChanged.addListener((e,s)=>{s==="local"&&(e.scrollType&&(t.setSettings({scrollType:e.scrollType.newValue}),t.running&&t.start()),e.speed&&(t.setSettings({speed:e.speed?.newValue??t.speed}),t.running&&t.start()),(e.distance||e.delay)&&(t.setSettings({distance:e.distance?.newValue??t.distance,delay:e.delay?.newValue??t.delay}),t.running&&t.start()),e.spaceEnabled&&(t.setSettings({spaceEnabled:e.spaceEnabled.newValue}),console.log("space enabled: ",t.spaceEnabled)),e.disabledSites&&t.setEnabled(!e.disabledSites.newValue.includes(location.hostname)))});document.addEventListener("keydown",e=>{t.enabled&&(["INPUT","TEXTAREA"].includes(e.target.tagName)||e.target.isContentEditable||e.code==="Space"&&t.spaceEnabled&&(e.preventDefault(),t.toggle()))});document.addEventListener("visibilitychange",()=>{document.hidden&&t.stop()});
