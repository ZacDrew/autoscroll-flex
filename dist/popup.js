const i={GLIDE:"glide",STEP:"step"},l={GLIDE_TAB:"glide-tab",STEP_TAB:"step-tab"},o={SCROLL_TYPE:"scrollType"},n={SCROLL_TYPE:i.GLIDE,SPEED:100,DISTANCE:300,DELAY:2,SPACE_ENABLED:!1,DISABLED_SITES:["www.youtube.com","www.twitch.tv"]};document.addEventListener("DOMContentLoaded",()=>{new g().init()});class g{constructor(){this.form=document.getElementById("popupForm"),this.scrollToggleBtn=document.getElementById("toggleScroll"),this.store=new u,this.tab=null,this.hostname=null,this.tabButtons=document.querySelectorAll(".tab-btn"),this.tabContents=document.querySelectorAll(".tab-content")}async init(){await this.initTab(),this.bindEvents(),await this.syncPopupSettings(),await this.syncScrollState()}async initTab(){const[t]=await browser.tabs.query({active:!0,currentWindow:!0});t&&(this.tab=t,this.hostname=new URL(t.url).hostname)}bindEvents(){this.form.addEventListener("change",t=>this.handleFormChange(t)),document.addEventListener("click",t=>this.handleButtonClick(t)),this.tabButtons.forEach(t=>{t.addEventListener("click",e=>this.handleTabs(e))})}async handleFormChange(t){const e={};if(t.target.id==="speed"&&(e.speed=Number(t.target.value)),["distance","delay"].includes(t.target.id)&&(e.distance=Number(distance.value),e.delay=Number(delay.value)),t.target.id==="spaceEnabled"&&(e.spaceEnabled=t.target.checked),t.target.id==="scrollingEnabled"){const s=t.target.checked;e.disabledSites=await this.store.toggleSite(this.hostname,s),this.scrollToggleBtn.disabled=!s}await this.store.set(e),await this.syncScrollState(),console.log("change:",e)}async handleButtonClick(t){const e=t.target.closest("button");if(e&&e===this.scrollToggleBtn){const s=e.dataset.running==="true",a=s?"stop":"start";await browser.tabs.sendMessage(this.tab.id,{from:"popup",command:a}),e.textContent=s?"Start":"Stop",e.dataset.running=String(!s)}}async handleTabs(t){const e=t.currentTarget;e.dataset.tab===l.GLIDE_TAB&&await this.store.set({[o.SCROLL_TYPE]:i.GLIDE}),e.dataset.tab===l.STEP_TAB&&await this.store.set({[o.SCROLL_TYPE]:i.STEP}),this.setActiveTab(e)}setActiveTab(t){this.tabButtons.forEach(s=>s.classList.remove("active")),t.classList.add("active"),this.tabContents.forEach(s=>s.style.display="none");const e=t.dataset.tab;document.getElementById(e).style.display="block"}async syncPopupSettings(){const{scrollType:t=n.SCROLL_TYPE,speed:e=n.SPEED,distance:s=n.DISTANCE,delay:a=n.DELAY,spaceEnabled:d=n.SPACE_ENABLED,disabledSites:r=n.DISABLED_SITES}=await this.store.get();t===i.GLIDE?this.setActiveTab(document.querySelector('.tab-btn[data-tab="glide-tab"]')):t===i.STEP&&this.setActiveTab(document.querySelector('.tab-btn[data-tab="step-tab"]')),document.getElementById("speed").value=e,document.getElementById("distance").value=s,document.getElementById("delay").value=a,document.getElementById("spaceEnabled").checked=d,r.includes(this.hostname)&&(document.getElementById("scrollingEnabled").checked=!1,this.scrollToggleBtn.disabled=!0),console.log("init: ",{speed:e,distance:s,delay:a})}async syncScrollState(){if(this.tab)try{const{running:t}=await browser.tabs.sendMessage(this.tab.id,{command:"status"});this.scrollToggleBtn.textContent=t?"Stop":"Start",this.scrollToggleBtn.dataset.running=String(t)}catch{this.scrollToggleBtn.textContent="Start",this.scrollToggleBtn.dataset.running="false"}}}class u{async get(){return browser.storage.local.get(["scrollType","speed","distance","delay","spaceEnabled","disabledSites"])}async set(t){return browser.storage.local.set(t)}async toggleSite(t,e){let{disabledSites:s=[]}=await this.get();return e?s.filter(a=>a!==t):[...new Set([...s,t])]}}
